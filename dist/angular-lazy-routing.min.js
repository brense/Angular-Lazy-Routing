angular.module("ngLazyRouting",["ngRoute"]),angular.module("ngLazyRouting").config(["$provide","$controllerProvider","$routeProvider",function(a,b,c){angular.module("ngLazyRouting").controller=b.register,a.factory("$routeProvider",function(){return c})}]),angular.module("ngLazyRouting").run(["$routeProvider","$routingConfig","RoutingService",function(a,b,c){if("undefined"==typeof b.callback)throw new Error("Please provide a route callback function using setRouteCallback");var d=["/","/:page*"];if("undefined"!=typeof b.routes)var d=b.routes;for(var e in d)a.when(d[e],{template:'<div ng-include="templateUrl"></div>',resolve:{load:c.route}});a.otherwise({redirectTo:"/"})}]),angular.module("ngLazyRouting").provider("$routingConfig",function(){this.error={401:{name:"unauthorized",template:"<div>401 Unauthorized</div>"},403:{name:"forbidden",template:"<div>403 Forbidden</div>"},404:{name:"notfound",template:"<div>404 Not Found</div>"}},this.setRoutes=function(a){return this.routes=a,this},this.setErrorTemplate=function(a,b){return this.error[a]=b,this},this.setRouteCallback=function(a){return this.callback=a,this},this.$get=function(){return this}}),angular.module("ngLazyRouting").service("RoutingService",["$rootScope","$q","$templateCache","$route","$routingConfig",function(a,b,c,d,e){function i(a){var c=b.defer();if("undefined"==typeof h[a]){var d=document.createElement("script");d.type="text/javascript",d.src=a,d.onload=function(){h[a]=!0,c.resolve()},d.onreadystatechange=function(){"complete"===this.readyState&&(h[a]=!0,c.resolve())},document.getElementsByTagName("head")[0].appendChild(d)}else c.resolve();return c.promise}var f=this,g={},h={};this.route=function(){var a=b.defer(),c=d.current.originalPath;if("undefined"!=typeof d.current.pathParams.page&&(c=d.current.pathParams.page),"undefined"==typeof g[c]){var h=angular.injector(["ng"]);h.instantiate(e.callback,{path:0===c.indexOf("/")?c:"/"+c}).then(function(b){g[c]=b;var d=[];"undefined"!=typeof b.controllers&&d.push(b.controller.path),"undefined"!=typeof b.dependencies&&(d=d.concat(b.dependencies)),f.loadScripts(d).then(function(){f.applyRouteChange(c,b),a.resolve()})}).catch(function(b){f.handleErrors(b),a.resolve()})}else f.applyRouteChange(c,g[c]),a.resolve();return a.promise},this.handleErrors=function(b){if(a.$broadcast("routing error",b),"undefined"!=typeof e.error[b.status]){var d=e.error[b.status],f=d.name;"undefined"!=typeof d.template?c.put(f,d.template):"undefined"!=typeof d.templateUrl&&(f=d.templateUrl),a.templateUrl=f}},this.applyRouteChange=function(b,e){"undefined"!=typeof e.template?(c.put(b,e.template),a.templateUrl=b):"undefined"!=typeof e.templateUrl&&(a.templateUrl=e.templateUrl),"undefined"!=typeof e.controller&&(d.current.controller=e.controller.name)},this.loadScripts=function(a){var c=[];for(var d in a)c.push(i(a[d]));return b.all(c)}}]);